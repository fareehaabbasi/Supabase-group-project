<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SkillSphere | Login & Signup</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Dark Theme -->
    <link
      href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@5/dark.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    />

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
      :root {
        --primary: #000000;
        --secondary: #e4a998;
        --accent: #a87a87;
        --bg: #121212;
        --text: #ffffff;
      }

      body {
        background-color: var(--bg);
        color: var(--text);
        font-family: "Poppins", sans-serif;
        height: 100vh;
        margin: 0;
        overflow: hidden;
      }

      /* Main Section */
      .main-sec {
        display: flex;
        height: 100vh;
      }

      /* Left Side Fixed Image */
      .left-side {
        position: fixed;
        top: 0;
        left: 0;
        width: 50%;
        height: 100vh;
        background: url("./assets/images/sign-up-imge.jpg") center/cover
          no-repeat;
      }

      .left-side::after {
        content: "";
        position: absolute;
        inset: 0;
        background: rgba(27, 21, 21, 0.7); /* velvet black overlay */
      }

      /* Text Overlay */
      .overlay-text {
        position: relative;
        z-index: 1;
        color: var(--secondary);
        font-size: 2rem;
        font-weight: 700;
        letter-spacing: 1px;
        text-transform: uppercase;
        font-family: "Poppins", sans-serif;
        margin-left: 1vw;
        margin-top: 1vw;
      }

      /* Right Side (Form) */
      .right-side {
        margin-left: 50%;
        width: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
        overflow-y: auto;
      }

      /* Auth Card */
      .auth-card {
        background: rgba(0, 0, 0, 0.85);
        border: 1px solid var(--accent);
        border-radius: 20px;
        box-shadow: 0 0 25px rgba(232, 169, 152, 0.2);
        padding: 2.5rem;
        width: 100%;
        max-width: 550px;
      }

      /* Nav Tabs */
      .nav-tabs {
        border: none;
        justify-content: center;
        margin-bottom: 1.5rem;
      }

      .nav-tabs .nav-link {
        border: none;
        color: var(--secondary);
        font-weight: 500;
      }

      .nav-tabs .nav-link.active {
        background-color: transparent;
        border-bottom: 2px solid var(--secondary);
        color: #fff;
      }

      /* Input fields style */
      .form-control {
        background-color: #1f1f1f; /* dark input bg */
        border: 1px solid #333;
        color: #fff; /* actual text color */
        border-radius: 10px;
        height: 50px;
        font-size: 1rem;
        padding: 12px 16px;
      }

      /* Placeholder color fix */
      .form-control::placeholder {
        color: #aaa; /* soft gray for visibility */
        opacity: 1; /* ensure color shows properly */
      }

      /* Focus state */
      .form-control:focus {
        background-color: #1f1f1f; /* stays dark even on focus */
        color: #fff;
        border-color: var(--secondary);
        box-shadow: 0 0 0 0.2rem rgba(228, 169, 152, 0.25); /* peach glow */
      }

      /* Buttons */
      .btn-custom {
        background-color: var(--secondary);
        color: #000;
        height: 50px;
        border-radius: 10px;
        font-weight: 600;
        padding: 12px 0;
        margin-top: 0.8vw;
      }

      .btn-custom:hover {
        background-color: var(--accent);
        color: #fff;
      }

      /* Footer */
      .footer-text {
        margin-top: 1rem;
        font-size: 0.9rem;
        color: #aaa;
      }

      /* Mobile Responsive */
      @media (max-width: 991px) {
        .left-side {
          display: none;
        }

        .right-side {
          margin-left: 0;
          width: 100%;
        }
      }

      #loader-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.4);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }

      .toggle-eye {
        position: absolute;
        right: 15px;
        top: 67%;
        transform: translateY(-50%);
        color: #a87a87; /* accent color */
        cursor: pointer;
      }
      .toggle-eye:hover {
        color: #e4a998;
      }

      #loader {
        display: none;
        width: 60px;
        aspect-ratio: 2;
        --_g: no-repeat radial-gradient(circle closest-side, #125b9a 90%, #0000);
        background: var(--_g) 0% 50%, var(--_g) 50% 50%, var(--_g) 100% 50%;
        background-size: calc(100% / 3) 50%;
        animation: l3 1s infinite linear;
      }

      @keyframes l3 {
        20% {
          background-position: 0% 0%, 50% 50%, 100% 50%;
        }
        40% {
          background-position: 0% 100%, 50% 0%, 100% 50%;
        }
        60% {
          background-position: 0% 50%, 50% 100%, 100% 0%;
        }
        80% {
          background-position: 0% 50%, 50% 50%, 100% 100%;
        }
      }

      .swal2-input {
        margin: 0.5rem 0;
        margin-left: 1rem;
      }
    </style>
  </head>
  <body>
    <div class="main-sec">
      <div class="left-side">
        <div class="overlay-text">SKILLSPHERE</div>
      </div>

      <div class="right-side">
        <div class="auth-card">
          <ul class="nav nav-tabs" id="authTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="login-tab"
                data-bs-toggle="tab"
                data-bs-target="#login"
                type="button"
              >
                Login
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="signup-tab"
                data-bs-toggle="tab"
                data-bs-target="#signup"
                type="button"
              >
                Signup
              </button>
            </li>
          </ul>

          <div class="tab-content" id="authTabsContent">
            <!-- Login -->
            <div class="tab-pane fade show active" id="login" role="tabpanel">
              <h4 class="text-center mb-3">Welcome Back</h4>
              <form id="login-form">
                <div class="mb-3">
                  <label for="loginEmail" class="form-label">Email</label>
                  <input
                    type="email"
                    class="form-control"
                    id="L-email"
                    placeholder="Enter your email"
                    required
                  />
                </div>
                <div class="mb-3 position-relative">
                  <label for="loginPassword" class="form-label">Password</label>
                  <input
                    type="password"
                    class="form-control pe-5"
                    id="L-password"
                    placeholder="Enter your password"
                    required
                  />
                  <i class="fa-solid fa-eye-slash toggle-eye"></i>
                </div>
                <button type="submit" class="btn btn-custom w-100">
                  Login
                </button>
              </form>
            </div>

            <!-- Signup -->
            <div class="tab-pane fade" id="signup" role="tabpanel">
              <h4 class="text-center mb-3">Create an Account</h4>
              <form id="signup-Form">
                <div class="mb-3">
                  <label for="signupName" class="form-label">Full Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="username"
                    placeholder="Enter your name"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="signupEmail" class="form-label">Email</label>
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    placeholder="Enter your email"
                    required
                  />
                </div>
                <div class="mb-3 position-relative">
                  <label for="signupPassword" class="form-label">Password</label>
                  <input
                    type="password"
                    class="form-control"
                    id="password"
                    placeholder="Create a password"
                    required
                  />
                  <i class="fa-solid fa-eye-slash toggle-eye"></i>
                </div>
                <button type="submit" class="btn btn-custom w-100">
                  Signup
                </button>
              </form>
            </div>
          </div>

          <p class="text-center footer-text">
            © 2025 SkillSphere. Designed with ❤️ by SheCodes Collective
          </p>
        </div>
      </div>
    </div>

    <div id="loader-overlay">
      <div class="spinner-border text-primary loader-spinner" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <script type="module" src="config.js"></script>
    <script type="module">
      import client from "./config.js";
      console.log(client);

      //----------loader functions---------//
      const loaderOverlay = document.getElementById("loader-overlay");
      function showLoader() {
        loaderOverlay.style.display = "flex";
      }

      function hideLoader() {
        loaderOverlay.style.display = "none";
      }

      //--------Signup Functionality--------//
      const signupForm = document.getElementById("signup-Form");

      const signName = document.getElementById("username");
      const signEmail = document.getElementById("email");
      const signPassword = document.getElementById("password");

      async function signup(e) {
        e.preventDefault();

        if (signEmail.value && signName.value && signPassword.value) {
          showLoader();
          try {
            const { data, error } = await client.auth.signUp({
              email: signEmail.value,
              password: signPassword.value,
              options: {
                data: {
                  Name: signName.value,
                },
              },
            });
            // if (data) {
            //   console.log(data);
            //   const {
            //     user: {
            //       email,
            //       user_metadata: { Name},
            //     },
            //   } = data;
            //   try {
            //     const { error } = await client.from("user").insert({
            //       name: Name,
            //       emai: email,
            //       phone: phone,
            //     });
            //     if (error) {
            //       console.log(error);
            //     }
            //   } catch (err) {
            //     console.log(err);
            //   }
            // }
            if (error) throw error;

            Swal.fire({
              title: "Sign up successful!",
              text: "Now login with your new account 🎉",
              icon: "success",
              confirmButtonText: "OK",
            }).then(() => {
              window.location.href = "home.html";
            });
          } catch (error) {
            console.error(error);
            if (signEmail.value === "" || signPassword.value === "") {
              Swal.fire({
                icon: "warning",
                title: "Missing Fields",
                text: "Please fill all fields",
              });
            } else {
              Swal.fire({
                icon: "error",
                title: "signup Failed",
                text: error.message || "Something went wrong 😢",
              });
            }
          } finally {
            hideLoader();
          }
        } else {
          Swal.fire({
            icon: "warning",
            title: "Missing Fields",
            text: "Please fill all fields",
          });
        }
      }
      signupForm && signupForm.addEventListener("submit", signup);

      //----------  Login Functionality---------//
      //---------Login authentication
let loginForm = document.getElementById("login-form");

let loginEmail = document.getElementById("L-email");
let loginPassword = document.getElementById("L-password");

async function login(e) {
  e.preventDefault();

  if (loginEmail.value && loginPassword.value) {
    showLoader();
    try {
      const { data, error } = await client.auth.signInWithPassword({
        email: loginEmail.value,
        password: loginPassword.value,
      });
      if (error) throw error;

      const Toast = Swal.mixin({
        toast: true,
        position: "top-end",
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true,
        didOpen: (toast) => {
          toast.onmouseenter = Swal.stopTimer;
          toast.onmouseleave = Swal.resumeTimer;
        },
      });

      Toast.fire({
        icon: "success",
        title: "Login successful!",
      });

      setTimeout(() => {
        window.location.href = "home.html";
      }, 1500);
    } catch (error) {
      console.error(error);
      if (loginEmail.value === "" || loginPassword.value === "") {
        Swal.fire({
          icon: "warning",
          title: "Missing Fields",
          text: "Please fill all fields",
        });
      } else {
        Swal.fire({
          icon: "error",
          title: "Login Failed",
          text: error.message || "Something went wrong 😢",
        });
      }
    } finally {
      hideLoader();
    }
  } else {
    Swal.fire({
      icon: "warning",
      title: "Missing Fields",
      text: "Please fill all fields",
    });
  }
}

loginForm && loginForm.addEventListener("submit", login);

// -------- Toggle Eye Button -------- //
const toggleBtns = document.querySelectorAll(".toggle-eye");

toggleBtns.forEach((btn) => {
  btn.addEventListener("click", () => {
    // Find the related input field (previous sibling)
    const input = btn.previousElementSibling;

    if (input.type === "password") {
      input.type = "text";
      btn.classList.remove("fa-eye-slash");
      btn.classList.add("fa-eye");
    } else {
      input.type = "password";
      btn.classList.remove("fa-eye");
      btn.classList.add("fa-eye-slash");
    }
  });
});

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
